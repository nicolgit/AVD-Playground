{
  "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
  "contentVersion": "1.0.0.0",
  "metadata": {
    "_generator": {
      "name": "bicep",
      "version": "0.29.47.4906",
      "templateHash": "6589624658957367078"
    }
  },
  "parameters": {
    "location": {
      "type": "string",
      "defaultValue": "westeurope"
    },
    "romehostpoolName": {
      "type": "string",
      "defaultValue": "rome-hostpool"
    },
    "romePreferredAppGroupType": {
      "type": "string",
      "defaultValue": "Desktop"
    },
    "romeDesktopGroupName": {
      "type": "string",
      "defaultValue": "roma-desktop"
    },
    "romeRemoteAppGroupName": {
      "type": "string",
      "defaultValue": "roma-remoteapp"
    },
    "romeWorkspaceName": {
      "type": "string",
      "defaultValue": "roma-workspace"
    },
    "milanhostpoolName": {
      "type": "string",
      "defaultValue": "milan-hostpool"
    },
    "milanPreferredAppGroupType": {
      "type": "string",
      "defaultValue": "RailApplications"
    },
    "milanDesktopGroupName": {
      "type": "string",
      "defaultValue": "milano-desktop"
    },
    "milanRemoteAppGroupName": {
      "type": "string",
      "defaultValue": "milano-remoteapp"
    },
    "milanWorkspaceName": {
      "type": "string",
      "defaultValue": "milano-workspace"
    }
  },
  "resources": [
    {
      "type": "Microsoft.DesktopVirtualization/hostPools",
      "apiVersion": "2024-04-03",
      "name": "[parameters('romehostpoolName')]",
      "location": "[parameters('location')]",
      "properties": {
        "hostPoolType": "Pooled",
        "loadBalancerType": "BreadthFirst",
        "preferredAppGroupType": "[parameters('romePreferredAppGroupType')]"
      }
    },
    {
      "type": "Microsoft.DesktopVirtualization/applicationGroups",
      "apiVersion": "2024-04-03",
      "name": "[parameters('romeDesktopGroupName')]",
      "location": "[parameters('location')]",
      "properties": {
        "applicationGroupType": "Desktop",
        "hostPoolArmPath": "[resourceId('Microsoft.DesktopVirtualization/hostPools', parameters('romehostpoolName'))]"
      },
      "dependsOn": [
        "[resourceId('Microsoft.DesktopVirtualization/hostPools', parameters('romehostpoolName'))]"
      ]
    },
    {
      "type": "Microsoft.DesktopVirtualization/applicationGroups",
      "apiVersion": "2024-04-03",
      "name": "[parameters('romeRemoteAppGroupName')]",
      "location": "[parameters('location')]",
      "properties": {
        "applicationGroupType": "RemoteApp",
        "hostPoolArmPath": "[resourceId('Microsoft.DesktopVirtualization/hostPools', parameters('romehostpoolName'))]"
      },
      "dependsOn": [
        "[resourceId('Microsoft.DesktopVirtualization/hostPools', parameters('romehostpoolName'))]"
      ]
    },
    {
      "type": "Microsoft.DesktopVirtualization/workspaces",
      "apiVersion": "2024-04-03",
      "name": "[parameters('romeWorkspaceName')]",
      "location": "[parameters('location')]",
      "properties": {
        "applicationGroupReferences": [
          "[resourceId('Microsoft.DesktopVirtualization/applicationGroups', parameters('romeDesktopGroupName'))]",
          "[resourceId('Microsoft.DesktopVirtualization/applicationGroups', parameters('romeRemoteAppGroupName'))]"
        ]
      },
      "dependsOn": [
        "[resourceId('Microsoft.DesktopVirtualization/applicationGroups', parameters('romeDesktopGroupName'))]",
        "[resourceId('Microsoft.DesktopVirtualization/applicationGroups', parameters('romeRemoteAppGroupName'))]"
      ]
    },
    {
      "type": "Microsoft.DesktopVirtualization/hostPools",
      "apiVersion": "2024-04-03",
      "name": "[parameters('milanhostpoolName')]",
      "location": "[parameters('location')]",
      "properties": {
        "hostPoolType": "Pooled",
        "loadBalancerType": "BreadthFirst",
        "preferredAppGroupType": "[parameters('milanPreferredAppGroupType')]"
      }
    },
    {
      "type": "Microsoft.DesktopVirtualization/applicationGroups",
      "apiVersion": "2024-04-03",
      "name": "[parameters('milanDesktopGroupName')]",
      "location": "[parameters('location')]",
      "properties": {
        "applicationGroupType": "Desktop",
        "hostPoolArmPath": "[resourceId('Microsoft.DesktopVirtualization/hostPools', parameters('milanhostpoolName'))]"
      },
      "dependsOn": [
        "[resourceId('Microsoft.DesktopVirtualization/hostPools', parameters('milanhostpoolName'))]"
      ]
    },
    {
      "type": "Microsoft.DesktopVirtualization/applicationGroups",
      "apiVersion": "2024-04-03",
      "name": "[parameters('milanRemoteAppGroupName')]",
      "location": "[parameters('location')]",
      "properties": {
        "applicationGroupType": "RemoteApp",
        "hostPoolArmPath": "[resourceId('Microsoft.DesktopVirtualization/hostPools', parameters('milanhostpoolName'))]"
      },
      "dependsOn": [
        "[resourceId('Microsoft.DesktopVirtualization/hostPools', parameters('milanhostpoolName'))]"
      ]
    },
    {
      "type": "Microsoft.DesktopVirtualization/workspaces",
      "apiVersion": "2024-04-03",
      "name": "[parameters('milanWorkspaceName')]",
      "location": "[parameters('location')]",
      "properties": {
        "applicationGroupReferences": [
          "[resourceId('Microsoft.DesktopVirtualization/applicationGroups', parameters('milanDesktopGroupName'))]",
          "[resourceId('Microsoft.DesktopVirtualization/applicationGroups', parameters('milanRemoteAppGroupName'))]"
        ]
      },
      "dependsOn": [
        "[resourceId('Microsoft.DesktopVirtualization/applicationGroups', parameters('milanDesktopGroupName'))]",
        "[resourceId('Microsoft.DesktopVirtualization/applicationGroups', parameters('milanRemoteAppGroupName'))]"
      ]
    }
  ]
}